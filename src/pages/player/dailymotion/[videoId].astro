---
import Player from "../../../components/Player.astro";
import Layout from "../../../layouts/Layout.astro";
import { Dailymotion } from "../../../scrapper/dailymotion";
import type { Options, SourceInfo } from "plyr";

const videoId = Astro.params.videoId;

if (!videoId) {
    return {
        status: 404,
        error: "Video ID is required",
    };
}

const dm = new Dailymotion(videoId);
await dm.fetchData();

const source: SourceInfo = {
    type: "video",
    poster: dm.metadata.thumbnails["1080"],
    sources: dm.m3u8Data.map((m3u8: any) => ({
        src: m3u8.url,
        type: "video/mp4",
        size: m3u8.name,
    })),
};

const options: Options = {
    controls: [
        "play",
        "progress",
        "current-time",
        "mute",
        "volume",
        "settings",
        "fullscreen",
    ],
};
---

<Layout title={dm.metadata.title}>
    <!-- <Player source={source} options={options} /> -->
</Layout>
